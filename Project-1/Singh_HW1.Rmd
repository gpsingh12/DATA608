---
title: "Assignment 1"
author: "Gurpreet Singh"
date: "September 10, 2019"
output: html_document
---



```{r}
suppressWarnings(suppressMessages(library(data.table)))
suppressWarnings(suppressMessages(library(dplyr)))
suppressWarnings(suppressMessages(library(ggplot2)))
suppressWarnings(suppressMessages(library(knitr)))
suppressWarnings(suppressMessages(library(psych)))
suppressWarnings(suppressMessages(library(scales)))
```



#### Read data
```{r}
inc <- fread("https://raw.githubusercontent.com/charleyferrari/CUNY_DATA_608/master/module1/Data/inc5000_data.csv")
```




#### Data Exploration

```{r}

dim(inc)


kable(head(inc))

str(inc)


summary(inc)


colSums(is.na(inc))
```


The dataset has 8 variables and 5,001 records. The Employement column has 12 missing records. Exploratrion of summary reveals that on average there are 233 employees in an industry. Average growth rate per industry is 4.6%. On average, the revenue generated by the industries is $48,222,535


#### 1. Create a graph that shows the distribution of companies in the dataset by State (ie how many are in each state). There are a lot of States, so consider which axis you should use. This visualization is ultimately going to be consumed on a 'portrait' oriented screen (ie taller than wide), which should further guide your layout choices.



```{r}

q1 <- inc %>% group_by(State) %>% summarise(Count = n()) 
ggplot(q1, aes(x=State, y=Count)) +
 geom_bar(stat="identity", width=0.5,fill= "grey") +  coord_flip() +
 geom_text(aes(label=Count), size=2.5) +
 ylab("Count of Companies") + xlab("State") +
 ggtitle("Distribution of Companies by State")+
 theme(text = element_text(size = 8),panel.background = element_rect(fill='white', colour="white"))


```


California has mst number of states.



#### 2.Lets dig in on the state with the 3rd most companies in the data set. Imagine you work for the state and are interested in how many people are employed by companies in different industries. Create a plot that shows the average and/or median employment by industry for companies in this state (only use cases with full data, use R's `complete.cases()` function.) In addition to this, your graph should show how variable the ranges are, and you should deal with outliers.




```{r}
q2 <- q1 %>% arrange(-Count) 
top_n(q2,3)

q2 <- inc %>%filter(State=="NY") %>% na.omit()


 ggplot(q2, aes(x=Industry, y=Employees)) + 
  stat_boxplot(geom ='errorbar') +
  geom_boxplot() +
    coord_cartesian(ylim = c(0,1000)) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust=0.3))+
ggtitle("NY Employee Count by Industry") 

```



It is clear from the graph that there are outliers in Human Resources, IT services, Advertising and Marketing and few other industries. The default when plotting a boxplot, range=1.5, means that the whiskers will extend 1.5 times the interquartile range above the third quartile and below the first quartile; all other points will be labeled as outliers. [Link](https://stats.stackexchange.com/questions/211327/r-box-plot-on-log-scale-vs-log-transforming-then-creating-box-plot-dont-ge]). Due to the large difference in the ranges of different industries, the mean is not clearly evident from the box plot, bar plot depicting the mean is presented below.

```{r}
q2a <- inc %>% filter(State=="NY")%>%na.omit() %>% group_by(Industry)%>% summarize(avg =round(mean(Employees),1))
ggplot(q2a, aes(x=reorder(Industry, avg), y=avg)) +
 geom_bar(stat="identity",width=0.3,fill= "grey") +  coord_flip() +
 geom_text(aes(label=avg), size=2.5) +
 ylab("Count of Companies") + xlab("State") +
 ggtitle("Average Employees by Industry NY") +
  theme(text = element_text(size = 8),panel.background = element_rect(fill='white', colour="white"))

```



#### 3. Now imagine you work for an investor and want to see which industries generate the most revenue per employee. Create a chart that makes this information clear. Once again, the distribution per industry should be shown.

```{r}
q3 <- inc %>% na.omit() %>% group_by(Industry) %>%
  summarise(Revenue_Gen = sum(Revenue)/ sum(Employees))


ggplot(q3, aes(x = reorder(Industry, Revenue_Gen), y = Revenue_Gen)) + 
  geom_bar(stat="identity", fill="grey") +  coord_flip() + 
    ggtitle("Revenue per Employee by Industry") +
  geom_text( aes(label=dollar_format()(Revenue_Gen)), size=2.5) +
 ylab("") + xlab("") + theme_minimal()
  

 
```



A look at the graph reveals that Computer Hardware industry generates more revenue per employee followed by Energy and Construction. As an investor, I would review the numbers by the region of my investment and the graph can be broken down by State and Industry for additional trends.


##### References: 

https://stackoverflow.com/questions/13297995/changing-font-size-and-direction-of-axes-text-in-ggplot2 https://stackoverflow.com/questions/25061822/ggplot-geom-text-font-size-control?rq=1
https://stackoverflow.com/questions/37662119/custom-ggplot2-axis-and-label-formatting/37662563#37662563
https://stats.stackexchange.com/questions/211327/r-box-plot-on-log-scale-vs-log-transforming-then-creating-box-plot-dont-ge


